# Makefile for JADE project - 'doc' directory

DOC = javadoc

DOC_MAIN = $(SRCDIR)/jade-main.html
DOC_OUTDIR = $(DOCDIR)/api
DOC_WINTITLE = "$(PACKAGE) $(VERSION) API Reference"
TMPSRCDIR = $(DOCDIR)/__tmp

API_CLASSES = 	$(SRCDIR)/jade/core/AID.java $(SRCDIR)/jade/core/Agent.java $(SRCDIR)/jade/core/BehaviourID.java \
		$(SRCDIR)/jade/core/CaseInsensitiveString.java $(SRCDIR)/jade/core/Channel.java \
		$(SRCDIR)/jade/core/ContainerID.java $(SRCDIR)/jade/core/Location.java $(SRCDIR)/jade/core/NameClashException.java \
		$(SRCDIR)/jade/core/NotFoundException.java $(SRCDIR)/jade/core/Profile.java \
		$(SRCDIR)/jade/core/ProfileException.java $(SRCDIR)/jade/core/ProfileImpl.java \
		$(SRCDIR)/jade/core/Runtime.java $(SRCDIR)/jade/core/UnreachableException.java 

API_PACKAGES = 	jade.core jade.core.behaviours jade.lang jade.lang.acl jade.lang.sl jade.domain jade.domain.FIPAAgentManagement \
		jade.domain.JADEAgentManagement jade.proto jade.onto jade.onto.basic jade.gui jade.mtp jade.mtp.iiop \
		jade.onto.JADEMetaOntology jade.wrapper jade.core.event jade.domain.DFGUIManagement jade.domain.introspection

API_FLAGS = -d $(DOC_OUTDIR) -overview $(DOC_MAIN) -author -windowtitle $(DOC_WINTITLE)

SNIFFER_OUTDIR = $(DOCDIR)/tools/sniffer/html/jdoc
SNIFFER_FLAGS =  -d $(SNIFFER_OUTDIR) -author -windowtitle "$(PACKAGE) $(VERSION) Sniffer Reference"
SNIFFER_PACKAGES = jade.tools.sniffer

.PHONY: all clean api tools sniffer batch

all: api tools

api: $(DOC_OUTDIR)
	mkdir -p $(TMPSRCDIR); \
	cp -R $(SRCDIR)/* $(TMPSRCDIR); \
	rm -rf $(TMPSRCDIR)/jade/core/*.java; \
	cp $(API_CLASSES) $(TMPSRCDIR)/jade/core; \
	$(DOC) -sourcepath $(TMPSRCDIR) $(API_FLAGS) $(API_PACKAGES); \
	rm -rf $(TMPSRCDIR)

$(DOC_OUTDIR):
	mkdir -p $(DOC_OUTDIR)

tools: sniffer

sniffer: $(SNIFFER_OUTDIR)
	$(DOC) -sourcepath $(SRCDIR) $(SNIFFER_FLAGS) $(SNIFFER_PACKAGES)

$(SNIFFER_OUTDIR):
	mkdir -p $(SNIFFER_OUTDIR)

clean:

	rm -fr $(DOC_OUTDIR)/[a-z]*
	rm -fr $(SNIFFER_OUTDIR)/[a-z]*

batch: $(DOC_OUTDIR) $(SNIFFER_OUTDIR)
	rm -f $(BATCH_DOC);
	echo '@REM ===============================================================' > $(BATCH_DOC)
	echo '@REM =           Generated by JADE Makefile. DO NOT EDIT           =' >> $(BATCH_DOC)
	echo '@REM ===============================================================' >> $(BATCH_DOC)
	echo >> $(BATCH_DOC)
	echo '$(subst /,\,$(subst $(ROOTDIR),.,$(DOC))) $(subst /,\,$(subst $(ROOTDIR),.,$(API_FLAGS))) $(API_PACKAGES)' >> $(BATCH_DOC)
	echo >> $(BATCH_DOC)
	echo '$(subst /,\,$(subst $(ROOTDIR),.,$(DOC))) $(subst /,\,$(subst $(ROOTDIR),.,$(SNIFFER_FLAGS))) $(SNIFFER_PACKAGES)' >> $(BATCH_DOC)
	echo >> $(BATCH_DOC)
	echo 'del $(subst /,\,$(subst $(ROOTDIR),.,$(DOC_OUTDIR)))\*.html' >> $(BATCH_CLEAN)
	echo 'del $(subst /,\,$(subst $(ROOTDIR),.,$(DOC_OUTDIR)))\*.css' >> $(BATCH_CLEAN)
	echo 'del $(subst /,\,$(subst $(ROOTDIR),.,$(DOC_OUTDIR)))\*.' >> $(BATCH_CLEAN)
	echo 'rmdir /S /Q $(subst /,\,$(subst $(ROOTDIR),.,$(DOC_OUTDIR)))\jade' >> $(BATCH_CLEAN) # For Win NT
	echo 'deltree /Y $(subst /,\,$(subst $(ROOTDIR),.,$(DOC_OUTDIR)))\jade' >> $(BATCH_CLEAN)  # For Win 95/98
	echo 'del $(subst /,\,$(subst $(ROOTDIR),.,$(SNIFFER_OUTDIR)))\*.html' >> $(BATCH_CLEAN)
	echo 'del $(subst /,\,$(subst $(ROOTDIR),.,$(SNIFFER_OUTDIR)))\*.css' >> $(BATCH_CLEAN)
	echo 'del $(subst /,\,$(subst $(ROOTDIR),.,$(SNIFFER_OUTDIR)))\*.' >> $(BATCH_CLEAN)
	echo 'rmdir /S /Q $(subst /,\,$(subst $(ROOTDIR),.,$(SNIFFER_OUTDIR)))\jade' >> $(BATCH_CLEAN) # For Win NT
	echo 'deltree /Y $(subst /,\,$(subst $(ROOTDIR),.,$(SNIFFER_OUTDIR)))\jade' >> $(BATCH_CLEAN)  # For Win 95/98


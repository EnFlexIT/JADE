<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=iso-8859-1">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="StarOffice/5.2 (Win32)">
	<META NAME="AUTHOR" CONTENT="Daniel Le Berre">
	<META NAME="CREATED" CONTENT="20000814;14394714">
	<META NAME="CHANGEDBY" CONTENT="Daniel Le Berre">
	<META NAME="CHANGED" CONTENT="20000915;12225636">
	<STYLE>
	<!--
		@page { size: 8.27in 11.69in; margin-left: 1.25in; margin-right: 1.25in; margin-top: 1in; margin-bottom: 1in }
		H1 { margin-bottom: 0.08in; font-family: "Arial", sans-serif; font-size: 16pt }
		H2 { margin-bottom: 0.08in; font-family: "Arial", sans-serif; font-size: 14pt; font-style: italic }
		H3 { margin-bottom: 0.08in; font-family: "Arial", sans-serif }
	-->
	</STYLE>
</HEAD>
<BODY>
<H1 STYLE="border: none; padding: 0in">Using JADE with Java Server
Pages (JSP)</H1>
<P STYLE="margin-bottom: 0in; border: none; padding: 0in"><I>Author:
<A HREF="http://cafe.newcastle.edu.au/daniel/">Daniel Le Berre</A>
(daniel@cafe.newcastle.edu.au)</I></P>
<P STYLE="margin-bottom: 0in; border: none; padding: 0in"><I>Date: <SDFIELD TYPE=DOCINFO SUBTYPE=CHANGE FORMAT=DATE SDNUM="1033;1033;NNNNMMMM D, YYYY">Friday, September 15, 2000</SDFIELD></I></P>
<P STYLE="margin-bottom: 0in; border: none; padding: 0in"><I><FONT SIZE=2>Java
platform: <A HREF="http://java.sun.com/j2se/1.3/">Sun JDK 1.3
Windows, Sun JDK1.3 beta Solaris</A></FONT></I></P>
<P STYLE="margin-bottom: 0in; border: none; padding: 0in"><I><FONT SIZE=2>JSP
platform: <A HREF="http://java.sun.com/products/jsp/download.html">Sun
Java Server Web Development Kit (JSWDK) 1.0.1</A> , <A HREF="http://jakarta.apache.org/">Jakarta
Tomcat 3.1</A></FONT></I></P>
<P STYLE="margin-bottom: 0in; border: none; padding: 0in"><I><FONT SIZE=2><A HREF="http://jade.cselt.it/">JADE</A>
version 1.4 and 2.0</FONT></I></P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">One of the major interest when adopting
the Java Server Pages approach to generate dynamic HTML, is to be
able to use available Java APIs to handle various work such as
database connection, authentication, etc... One interesting feature
of JSP is also the convenient way to handle forms with JavaBeans. 
</P>
<P STYLE="margin-bottom: 0in">Since JADE is written in Java, it is
pretty easy to integrate JADE agents with JSP. This allows you to
have for instance an agent looking at all the connections made to a
particularly sensitive web page, and report you each of them (this is
particularly interesting in the Java Server Pages context for the
error page for instance). This will be the application we are going
to design in this tutorial.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><I>This tutorial assumes that:</I></P>
<UL>
	<LI><P STYLE="margin-bottom: 0in"><I>you are familiar with Java and
	have Java correctly installed.</I></P>
	<LI><P STYLE="margin-bottom: 0in"><I>you are familiar with JADE and
	have JADE correctly installed.</I></P>
	<LI><P STYLE="margin-bottom: 0in"><I>you are familiar with JSP and
	have a JSP enabled web server correctly installed.</I></P>
</UL>
<H2>The problem</H2>
<P STYLE="margin-bottom: 0in">We have three agents, namely <I>snooper</I>,
<I>buffer</I> and <I>client</I>. <I>Snooper</I> is the agent that is
living on the sensitive web page, <I>client</I> is an agent that must
display the information concerning the connections to the web page to
the webmaster. Since the latter can not be logged on his computer,
<I>buffer</I> is an agent that will keep the information if the
webmaster is not reachable. Furthermore, the snooper client must act
quickly to not delay the availability of the web page, so it will
just send the information for the webmaster trough the <I>buffer</I>,
that will always be reachable. <I>buffer</I> will manage the
connection with <I>client</I>: the latter will subscribe/unsubscribe
when it is launched/stopped. It will check that the client has really
received the information before deleting it. 
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in"><SPAN ID="Frame2" STYLE="float: left; width: 3.56in; height: 2.79in; border: none; padding: 0in; background: #ffffff">
	<P STYLE="margin-top: 0.08in; margin-bottom: 0.08in"><IMG SRC="svlm9lma.gif" NAME="Graphic1" ALIGN=LEFT WIDTH=342 HEIGHT=267 BORDER=0><BR CLEAR=LEFT><FONT SIZE=2><I>Drawing
	1 JADE agents</I></FONT></P>
</SPAN><BR CLEAR=LEFT><BR>
</P>
<H2>Creating the agents</H2>
<P STYLE="margin-bottom: 0in">The three agents are really easy to
construct. The code should work both under JADE 1.4 and JADE 2.0
after minor syntactical modifications given in the code.</P>
<H3><A HREF="Snooper.java.html">Snooper.java</A></H3>
<H3><A HREF="Buffer.java.html">Buffer.java</A></H3>
<H3><A HREF="Client.java.html">Client.java</A></H3>
<P STYLE="margin-bottom: 0in">There are two tips in this code:</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in">I am using the block() method both
	on Client and Buffer agents to avoid CPU consumption overhead.</P>
	<LI><P STYLE="margin-bottom: 0in">To be able to know if the client
	is alive or not, I need to wait for a reply from the client during
	10 seconds. If no confirmation arrive, I suppose that the agent is
	not there and I do not clear the message in the buffer agent.</P>
</UL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H3>Agent and JSP</H3>
<P>Now we have all our JADE agents defined. We need to integrate the
Snooper agent in our web page. Here is how to proceed.</P>
<H3><A HREF="testjade.html">testjade.jsp</A></H3>
<P>We first need to import some jade classes using the page import
statement. Then we declare our agent, <B>with an application scope</B>.
This is important because it means that the agent will have the same
life than the enclosing servlet (the JSP page). So the agent will
still living even if there is no connections to the page.
Furthermore, all the initialization code defined between the useBean
tags will be only executed once.</P>
<P STYLE="margin-bottom: 0in">To be able to use JADE agent, we need
at least one agent container on the JVM running the servlet. So we
need to integrate the call to JADE platform or container, usually
done from the command line, directly in the JSP page. Here I simulate
a command line call with no option for JADE 1.4, with the
&quot;-container&quot; for JADE 2.0, which means that the JADE
platform is running on the same machine than the JSP web server. A
JADE Agent Platform cannot be created within a JSP page because of
security restrictions. In the next releases of JADE this limitation
will probably be removed.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Once the JADE container is created, we
need to register our Snooper agent to the container. This is done
using the doStart() method. Note that the reference to our agent is
the ID defined in the useBean declaration.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">Now we can use our agent to snoop each
connection to this JSP page. Here the message sends the name of the
remote host, the date and the name of the web page.</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<H2>Putting everything to work</H2>
<P>Here is the architecture of our working JADE environment with a
JSP page.</P>
<P STYLE="margin-bottom: 0in"><SPAN ID="Frame1" STYLE="float: left; width: 4.76in; height: 2.22in; border: none; padding: 0in; background: #ffffff">
	<P STYLE="margin-top: 0.08in; margin-bottom: 0.08in"><IMG SRC="svlm9lmb.gif" NAME="Graphic2" ALIGN=LEFT WIDTH=457 HEIGHT=213 BORDER=0><BR CLEAR=LEFT><FONT SIZE=2><I>Drawing
	2 JADE containers</I></FONT></P>
</SPAN><BR CLEAR=LEFT><BR>
</P>
<UL>
	<LI><P STYLE="margin-bottom: 0in">The server contains two different
	JVM: one to run JSP/servlet plus one JADE container, and another one
	to run JADE platform. I don't see how to change this design since it
	does not seem possible to run the JADE platform directly inside
	JSP/Servlet JVM.</P>
	<LI><P STYLE="margin-bottom: 0in">The client is running another
	instance of the JVM to run a second JADE container.</P>
</UL>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">The interesting feature of this design
is that the platform (and the buffer agent) is dissociated from the
JSP page. Since each time that you change the JSP page you delete the
snooper agent and his container, using a separate container for the
buffer avoid to loose all the information it contains. 
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">To run this example, compile the three
agent java files. Put <FONT SIZE=2><FONT FACE="Courier New, monospace">Snooper.class</FONT></FONT>
and <FONT SIZE=2><FONT FACE="Courier New, monospace">Buffer.class</FONT></FONT>
in the server in a directory of the classpath of your JSP web server
(the <FONT SIZE=2><FONT FACE="Courier New, monospace">classes</FONT></FONT>
directory with tomcat, the <FONT SIZE=2><FONT FACE="Courier New, monospace">webpages/WEB-INF/jsp/beans/</FONT></FONT>
with JSWDK for instance). Do not forget to add JADE jar files in the
<FONT SIZE=2><FONT FACE="Courier New, monospace">lib</FONT></FONT>
directory of the JSP web server. (they will be added automatically on
the JSP web server classpath). Put <FONT SIZE=2><FONT FACE="Courier New, monospace">Client.class</FONT></FONT>
on the client computer. (I assume that JADE is installed on this
computers). Remember that if you use the package <FONT SIZE=2><FONT FACE="Courier New, monospace">examples.jsp</FONT></FONT>,
you have to put the class files in a subdirectory <FONT SIZE=2><FONT FACE="Courier New, monospace">examples/jsp/</FONT></FONT>.
Put the file <FONT SIZE=2><FONT FACE="Courier New, monospace">testjade.jsp</FONT></FONT>
in a directory accessible from your JSP web server (<FONT SIZE=2><FONT FACE="Courier New, monospace">webpages/</FONT></FONT>
for instance).</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">1. Run JADE platform with buffer agent
on the server</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<PRE STYLE="margin-bottom: 0.2in">java jade.Boot -platform buffer:examples.jsp.Buffer</PRE><P STYLE="margin-bottom: 0in">
<BR>
</P>
<P STYLE="margin-bottom: 0in">2. Run the JSP page with the snooper
agent on the server</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">request the testjade.jsp from your JSP
web server</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<P STYLE="margin-bottom: 0in">3. Run the client agent into a jade
container on the client</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
<PRE STYLE="margin-bottom: 0.2in">java jade.Boot -container -host server.domain daniel:examples.jsp.Client</PRE><P STYLE="margin-bottom: 0in">
<BR>
</P>
<P STYLE="margin-bottom: 0in"><BR>
</P>
</BODY>
</HTML>